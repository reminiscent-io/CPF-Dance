[
  {
    "schemaname": "public",
    "tablename": "assets",
    "policyname": "Authenticated users can view all assets",
    "qual": "true",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "assets",
    "policyname": "Instructors can delete their own assets",
    "qual": "((auth.uid() = instructor_id) OR (auth.uid() IN ( SELECT profiles.id\n   FROM profiles\n  WHERE (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "assets",
    "policyname": "Instructors can insert their own assets",
    "qual": null,
    "with_check": "((auth.uid() = instructor_id) AND (auth.uid() IN ( SELECT profiles.id\n   FROM profiles\n  WHERE (profiles.role = ANY (ARRAY['instructor'::user_role, 'admin'::user_role])))))"
  },
  {
    "schemaname": "public",
    "tablename": "assets",
    "policyname": "Instructors can update their own assets",
    "qual": "((auth.uid() = instructor_id) OR (auth.uid() IN ( SELECT profiles.id\n   FROM profiles\n  WHERE (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "classes",
    "policyname": "Admins can create classes",
    "qual": null,
    "with_check": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))"
  },
  {
    "schemaname": "public",
    "tablename": "classes",
    "policyname": "Admins can delete classes",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "classes",
    "policyname": "Admins can update all classes",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))",
    "with_check": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))"
  },
  {
    "schemaname": "public",
    "tablename": "classes",
    "policyname": "Admins can view all classes",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "classes",
    "policyname": "Dancers can view public classes",
    "qual": "((is_public = true) OR (instructor_id = auth.uid()) OR (EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['admin'::user_role, 'studio_admin'::user_role]))))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "classes",
    "policyname": "Everyone can view active classes",
    "qual": "(is_cancelled = false)",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "classes",
    "policyname": "Instructors can manage their classes",
    "qual": "((instructor_id = auth.uid()) OR (EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role)))))",
    "with_check": "((instructor_id = auth.uid()) OR (EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role)))))"
  },
  {
    "schemaname": "public",
    "tablename": "enrollments",
    "policyname": "Admins can manage all enrollments",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "enrollments",
    "policyname": "Admins can view all enrollments",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "enrollments",
    "policyname": "Instructors can delete their class enrollments",
    "qual": "(EXISTS ( SELECT 1\n   FROM classes\n  WHERE ((classes.id = enrollments.class_id) AND (classes.instructor_id = auth.uid()))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "enrollments",
    "policyname": "Instructors can manage their class enrollments",
    "qual": null,
    "with_check": "(EXISTS ( SELECT 1\n   FROM classes\n  WHERE ((classes.id = enrollments.class_id) AND (classes.instructor_id = auth.uid()))))"
  },
  {
    "schemaname": "public",
    "tablename": "enrollments",
    "policyname": "Instructors can update their class enrollments",
    "qual": "(EXISTS ( SELECT 1\n   FROM classes\n  WHERE ((classes.id = enrollments.class_id) AND (classes.instructor_id = auth.uid()))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "enrollments",
    "policyname": "Instructors can view all enrollments",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'instructor'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "enrollments",
    "policyname": "Instructors can view their class enrollments",
    "qual": "(EXISTS ( SELECT 1\n   FROM classes\n  WHERE ((classes.id = enrollments.class_id) AND (classes.instructor_id = auth.uid()))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "enrollments",
    "policyname": "Students can self-enroll",
    "qual": null,
    "with_check": "(EXISTS ( SELECT 1\n   FROM students\n  WHERE ((students.id = enrollments.student_id) AND (students.profile_id = auth.uid()))))"
  },
  {
    "schemaname": "public",
    "tablename": "enrollments",
    "policyname": "Students can view their enrollments",
    "qual": "(EXISTS ( SELECT 1\n   FROM students\n  WHERE ((students.id = enrollments.student_id) AND ((students.profile_id = ( SELECT auth.uid() AS uid)) OR (students.guardian_id = ( SELECT auth.uid() AS uid))))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "instructor_student_relationships",
    "policyname": "Admins and instructors can manage relationships",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['admin'::user_role, 'instructor'::user_role])))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "instructor_student_relationships",
    "policyname": "Admins can create relationships",
    "qual": null,
    "with_check": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))"
  },
  {
    "schemaname": "public",
    "tablename": "instructor_student_relationships",
    "policyname": "Dancers can view their relationships",
    "qual": "(student_id IN ( SELECT students.id\n   FROM students\n  WHERE (students.profile_id = auth.uid())))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "instructor_student_relationships",
    "policyname": "Instructors can create relationships",
    "qual": null,
    "with_check": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'instructor'::user_role))))"
  },
  {
    "schemaname": "public",
    "tablename": "lesson_pack_purchases",
    "policyname": "Instructors can view all purchases",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'instructor'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "lesson_pack_purchases",
    "policyname": "Students can create purchases",
    "qual": null,
    "with_check": "(EXISTS ( SELECT 1\n   FROM students\n  WHERE ((students.id = lesson_pack_purchases.student_id) AND ((students.profile_id = auth.uid()) OR (students.guardian_id = auth.uid())))))"
  },
  {
    "schemaname": "public",
    "tablename": "lesson_pack_purchases",
    "policyname": "Students can update their purchases",
    "qual": "(EXISTS ( SELECT 1\n   FROM students\n  WHERE ((students.id = lesson_pack_purchases.student_id) AND ((students.profile_id = auth.uid()) OR (students.guardian_id = auth.uid())))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "lesson_pack_purchases",
    "policyname": "Students can view their own purchases",
    "qual": "(EXISTS ( SELECT 1\n   FROM students\n  WHERE ((students.id = lesson_pack_purchases.student_id) AND ((students.profile_id = auth.uid()) OR (students.guardian_id = auth.uid())))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "lesson_pack_usage",
    "policyname": "Instructors can manage usage",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'instructor'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "lesson_pack_usage",
    "policyname": "Students can create usage records",
    "qual": null,
    "with_check": "(EXISTS ( SELECT 1\n   FROM lesson_pack_purchases\n  WHERE ((lesson_pack_purchases.id = lesson_pack_usage.lesson_pack_purchase_id) AND (EXISTS ( SELECT 1\n           FROM students\n          WHERE ((students.id = lesson_pack_purchases.student_id) AND ((students.profile_id = auth.uid()) OR (students.guardian_id = auth.uid()))))))))"
  },
  {
    "schemaname": "public",
    "tablename": "lesson_pack_usage",
    "policyname": "Students can view their usage",
    "qual": "(EXISTS ( SELECT 1\n   FROM lesson_pack_purchases\n  WHERE ((lesson_pack_purchases.id = lesson_pack_usage.lesson_pack_purchase_id) AND (EXISTS ( SELECT 1\n           FROM students\n          WHERE ((students.id = lesson_pack_purchases.student_id) AND ((students.profile_id = auth.uid()) OR (students.guardian_id = auth.uid()))))))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "lesson_packs",
    "policyname": "Admins can manage lesson packs",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "lesson_packs",
    "policyname": "Everyone can view active lesson packs",
    "qual": "(is_active = true)",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "notes",
    "policyname": "Admins can manage all notes",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "notes",
    "policyname": "Admins can view all notes",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "notes",
    "policyname": "Instructors can create notes for their students",
    "qual": null,
    "with_check": "((author_id = auth.uid()) AND ((student_id IS NULL) OR (EXISTS ( SELECT 1\n   FROM instructor_student_relationships\n  WHERE ((instructor_student_relationships.student_id = notes.student_id) AND (instructor_student_relationships.instructor_id = auth.uid()) AND (instructor_student_relationships.relationship_status = 'active'::text))))))"
  },
  {
    "schemaname": "public",
    "tablename": "notes",
    "policyname": "Instructors can manage notes",
    "qual": "(author_id = auth.uid())",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "notes",
    "policyname": "Instructors can manage their student notes",
    "qual": "((author_id = auth.uid()) OR (EXISTS ( SELECT 1\n   FROM instructor_student_relationships isr\n  WHERE ((isr.instructor_id = auth.uid()) AND (isr.student_id = notes.student_id) AND (isr.relationship_status = 'active'::text)))))",
    "with_check": "((author_id = auth.uid()) OR (EXISTS ( SELECT 1\n   FROM instructor_student_relationships isr\n  WHERE ((isr.instructor_id = auth.uid()) AND (isr.student_id = notes.student_id) AND (isr.relationship_status = 'active'::text)))))"
  },
  {
    "schemaname": "public",
    "tablename": "notes",
    "policyname": "Instructors can view all notes",
    "qual": "((EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'instructor'::user_role)))) AND ((author_id = auth.uid()) OR (EXISTS ( SELECT 1\n   FROM instructor_student_relationships isr\n  WHERE ((isr.instructor_id = auth.uid()) AND (isr.student_id = notes.student_id) AND (notes.visibility = 'shared_with_instructor'::note_visibility))))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "notes",
    "policyname": "Students can create self notes",
    "qual": null,
    "with_check": "((author_id = auth.uid()) AND (EXISTS ( SELECT 1\n   FROM students\n  WHERE ((students.id = notes.student_id) AND (students.profile_id = auth.uid())))) AND (visibility = ANY (ARRAY['private'::note_visibility, 'shared_with_instructor'::note_visibility])))"
  },
  {
    "schemaname": "public",
    "tablename": "notes",
    "policyname": "Students can view shared notes about them",
    "qual": "((EXISTS ( SELECT 1\n   FROM students\n  WHERE ((students.id = notes.student_id) AND ((students.profile_id = ( SELECT auth.uid() AS uid)) OR (students.guardian_id = ( SELECT auth.uid() AS uid))) AND (notes.visibility = ANY (ARRAY['shared_with_student'::note_visibility, 'shared_with_guardian'::note_visibility]))))) OR (author_id = ( SELECT auth.uid() AS uid)))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "notes",
    "policyname": "Students can view their notes",
    "qual": "((author_id = auth.uid()) OR ((student_id IS NOT NULL) AND (EXISTS ( SELECT 1\n   FROM students s\n  WHERE ((s.id = notes.student_id) AND ((s.profile_id = auth.uid()) OR (s.guardian_id = auth.uid())) AND (notes.visibility = ANY (ARRAY['shared_with_student'::note_visibility, 'shared_with_guardian'::note_visibility])))))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "notes",
    "policyname": "Students can view their own notes",
    "qual": "((author_id = auth.uid()) OR ((student_id IS NOT NULL) AND (EXISTS ( SELECT 1\n   FROM students s\n  WHERE ((s.id = notes.student_id) AND ((s.profile_id = auth.uid()) OR (s.guardian_id = auth.uid()))))) AND (visibility = ANY (ARRAY['shared_with_student'::note_visibility, 'shared_with_guardian'::note_visibility]))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "notes",
    "policyname": "Studio users can view notes shared with studio",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'studio_admin'::user_role) AND (notes.visibility = 'shared_with_studio'::note_visibility))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "payment_events",
    "policyname": "Admins can create payment events",
    "qual": null,
    "with_check": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))"
  },
  {
    "schemaname": "public",
    "tablename": "payment_events",
    "policyname": "Admins can manage payment events",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "payment_events",
    "policyname": "Admins can view all payment events",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "payment_events",
    "policyname": "Instructors can create payment events",
    "qual": null,
    "with_check": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'instructor'::user_role))))"
  },
  {
    "schemaname": "public",
    "tablename": "payment_events",
    "policyname": "Instructors can view payment events",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'instructor'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "payment_events",
    "policyname": "Instructors can view student payment events",
    "qual": "(EXISTS ( SELECT 1\n   FROM (payments p\n     JOIN instructor_student_relationships isr ON ((p.student_id = isr.student_id)))\n  WHERE ((p.id = payment_events.payment_id) AND (isr.instructor_id = auth.uid()) AND (isr.relationship_status = 'active'::text) AND (isr.can_view_payments = true))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "payment_events",
    "policyname": "Students can view their payment events",
    "qual": "(EXISTS ( SELECT 1\n   FROM (payments p\n     JOIN students s ON ((p.student_id = s.id)))\n  WHERE ((p.id = payment_events.payment_id) AND ((s.profile_id = auth.uid()) OR (s.guardian_id = auth.uid())))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "payment_events",
    "policyname": "Studio admins can view studio payment events",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'studio_admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "payments",
    "policyname": "Students can view their payments",
    "qual": "(EXISTS ( SELECT 1\n   FROM students\n  WHERE ((students.id = payments.student_id) AND ((students.profile_id = ( SELECT auth.uid() AS uid)) OR (students.guardian_id = ( SELECT auth.uid() AS uid))))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "personal_classes",
    "policyname": "Students can create their own personal classes",
    "qual": null,
    "with_check": "(EXISTS ( SELECT 1\n   FROM students\n  WHERE ((students.id = personal_classes.student_id) AND ((students.profile_id = auth.uid()) OR (students.guardian_id = auth.uid())))))"
  },
  {
    "schemaname": "public",
    "tablename": "personal_classes",
    "policyname": "Students can delete their own personal classes",
    "qual": "(EXISTS ( SELECT 1\n   FROM students\n  WHERE ((students.id = personal_classes.student_id) AND ((students.profile_id = auth.uid()) OR (students.guardian_id = auth.uid())))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "personal_classes",
    "policyname": "Students can update their own personal classes",
    "qual": "(EXISTS ( SELECT 1\n   FROM students\n  WHERE ((students.id = personal_classes.student_id) AND ((students.profile_id = auth.uid()) OR (students.guardian_id = auth.uid())))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "personal_classes",
    "policyname": "Students can view their own personal classes",
    "qual": "(EXISTS ( SELECT 1\n   FROM students\n  WHERE ((students.id = personal_classes.student_id) AND ((students.profile_id = auth.uid()) OR (students.guardian_id = auth.uid())))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "private_lesson_requests",
    "policyname": "Admins can manage all private lesson requests",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "private_lesson_requests",
    "policyname": "Admins can manage requests",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "private_lesson_requests",
    "policyname": "Instructors can manage requests",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'instructor'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "private_lesson_requests",
    "policyname": "Instructors can manage their requests",
    "qual": "(EXISTS ( SELECT 1\n   FROM instructor_student_relationships\n  WHERE ((instructor_student_relationships.student_id = private_lesson_requests.student_id) AND (instructor_student_relationships.instructor_id = auth.uid()) AND (instructor_student_relationships.relationship_status = 'active'::text))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "private_lesson_requests",
    "policyname": "Instructors can view requests",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'instructor'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "private_lesson_requests",
    "policyname": "Students can create requests",
    "qual": null,
    "with_check": "(EXISTS ( SELECT 1\n   FROM students\n  WHERE ((students.id = private_lesson_requests.student_id) AND ((students.profile_id = ( SELECT auth.uid() AS uid)) OR (students.guardian_id = ( SELECT auth.uid() AS uid))))))"
  },
  {
    "schemaname": "public",
    "tablename": "private_lesson_requests",
    "policyname": "Students can update their requests",
    "qual": "(EXISTS ( SELECT 1\n   FROM students\n  WHERE ((students.id = private_lesson_requests.student_id) AND (students.profile_id = auth.uid()))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "private_lesson_requests",
    "policyname": "Students can view their own requests",
    "qual": "(EXISTS ( SELECT 1\n   FROM students\n  WHERE ((students.id = private_lesson_requests.student_id) AND ((students.profile_id = ( SELECT auth.uid() AS uid)) OR (students.guardian_id = ( SELECT auth.uid() AS uid))))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "private_lesson_requests",
    "policyname": "Students can view their requests",
    "qual": "(EXISTS ( SELECT 1\n   FROM students\n  WHERE ((students.id = private_lesson_requests.student_id) AND ((students.profile_id = auth.uid()) OR (students.guardian_id = auth.uid())))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "profiles",
    "policyname": "Anyone can view profiles",
    "qual": "true",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "profiles",
    "policyname": "Users can update their own profile",
    "qual": "(auth.uid() = id)",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "students",
    "policyname": "Admins can manage all students",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "students",
    "policyname": "Admins can view all students",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "students",
    "policyname": "Dancers can view themselves",
    "qual": "(profile_id = auth.uid())",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "students",
    "policyname": "Instructors can create students",
    "qual": null,
    "with_check": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'instructor'::user_role))))"
  },
  {
    "schemaname": "public",
    "tablename": "students",
    "policyname": "Instructors can delete students",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'instructor'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "students",
    "policyname": "Instructors can update students",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'instructor'::user_role))))",
    "with_check": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'instructor'::user_role))))"
  },
  {
    "schemaname": "public",
    "tablename": "students",
    "policyname": "Instructors can view all students",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'instructor'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "students",
    "policyname": "Instructors can view their students",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'instructor'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "students",
    "policyname": "Students can view their own student record",
    "qual": "((profile_id = ( SELECT auth.uid() AS uid)) OR (guardian_id = ( SELECT auth.uid() AS uid)))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "students",
    "policyname": "Students can view themselves",
    "qual": "((profile_id = auth.uid()) OR (guardian_id = auth.uid()))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "studio_inquiries",
    "policyname": "Admins can link inquiries to studios",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "studio_inquiries",
    "policyname": "Admins can manage all inquiries",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "studio_inquiries",
    "policyname": "Admins can manage all studio inquiries",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "studio_inquiries",
    "policyname": "Admins can manage studio inquiries",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "studio_inquiries",
    "policyname": "Admins can view all studio inquiries",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "studio_inquiries",
    "policyname": "Admins can view studio inquiries",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "studio_inquiries",
    "policyname": "Anyone can create studio inquiries",
    "qual": null,
    "with_check": "true"
  },
  {
    "schemaname": "public",
    "tablename": "studio_inquiries",
    "policyname": "Instructors can view studio inquiries",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'instructor'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "studio_inquiries",
    "policyname": "Public can create inquiries",
    "qual": null,
    "with_check": "true"
  },
  {
    "schemaname": "public",
    "tablename": "studio_inquiries",
    "policyname": "Studio can view their inquiries",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'studio_admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "studios",
    "policyname": "Admins can manage all studios",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = ( SELECT auth.uid() AS uid)) AND (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "studios",
    "policyname": "Admins can manage studios",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = ( SELECT auth.uid() AS uid)) AND (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "studios",
    "policyname": "Admins can view all studios",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = ( SELECT auth.uid() AS uid)) AND (profiles.role = 'admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "studios",
    "policyname": "Instructors can create studios",
    "qual": null,
    "with_check": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = ( SELECT auth.uid() AS uid)) AND (profiles.role = 'instructor'::user_role))))"
  },
  {
    "schemaname": "public",
    "tablename": "studios",
    "policyname": "Instructors can update studios",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = ( SELECT auth.uid() AS uid)) AND (profiles.role = 'instructor'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "studios",
    "policyname": "Instructors can view all studios",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'instructor'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "studios",
    "policyname": "Public can view studios",
    "qual": "true",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "studios",
    "policyname": "Studio admins can update their studio",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'studio_admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "studios",
    "policyname": "Studio admins can view studios",
    "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'studio_admin'::user_role))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "waiver_signatures",
    "policyname": "Users can create waiver signatures",
    "qual": null,
    "with_check": "((EXISTS ( SELECT 1\n   FROM waivers\n  WHERE ((waivers.id = waiver_signatures.waiver_id) AND (auth.uid() = waivers.recipient_id)))) AND (auth.uid() = signed_by_id))"
  },
  {
    "schemaname": "public",
    "tablename": "waiver_signatures",
    "policyname": "Users can view waiver signatures with proper access",
    "qual": "(EXISTS ( SELECT 1\n   FROM waivers\n  WHERE ((waivers.id = waiver_signatures.waiver_id) AND ((auth.uid() = waivers.issued_by_id) OR (auth.uid() = waivers.recipient_id) OR (auth.uid() = waivers.signed_by_id) OR (EXISTS ( SELECT 1\n           FROM profiles\n          WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::user_role)))) OR (EXISTS ( SELECT 1\n           FROM (students\n             JOIN profiles ON ((profiles.id = auth.uid())))\n          WHERE ((students.profile_id = waivers.recipient_id) AND ((students.guardian_id = auth.uid()) OR (profiles.guardian_id = auth.uid())))))))))",
    "with_check": null
  },
  {
    "schemaname": "public",
    "tablename": "waiver_templates",
    "policyname": "Instructors and admins can create templates",
    "qual": null,
    "with_check": "((auth.uid() = created_by_id) AND (EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['instructor'::user_role, 'admin'::user_role]))))))"
  }
]